<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>MyCLabs\ACL</title>

        <link rel="stylesheet" href="http://myclabs.github.io/ACL/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://myclabs.github.io/ACL/css/highlight.github.css">
        <link rel="stylesheet" href="http://myclabs.github.io/ACL/css/main.css">

        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    </head>
    <body>
        <header class="navbar navbar-default">
            <a class="navbar-brand" href="http://myclabs.github.io/ACL/">
                MyCLabs\ACL
                <small class="hidden-xs hidden-sm">
                    Powerful and efficient access control library for your PHP application.
                </small>
            </a>
        </header>

        <div class="container-fluid">
            <div class="row">

                <nav id="sidebar" class="col-sm-3 col-lg-2" role="navigation">

                    <p class="text-muted">
                        Main documentation
                    </p>

                    <ul class="nav nav-pills nav-stacked">
                        <li class="">
                            <a href="http://myclabs.github.io/ACL/">
                                Introduction
                            </a>
                        </li>
                        <li class="">
                            <a href="http://myclabs.github.io/ACL/doc/setup.html">
                                Setup
                            </a>
                        </li>
                        <li class="active">
                            <a href="http://myclabs.github.io/ACL/doc/usage.html">
                                Usage
                            </a>
                        </li>
                    </ul>

                    <p class="text-muted">
                        Advanced topics
                    </p>

                    <ul class="nav nav-pills nav-stacked">
                        <li class="">
                            <a href="http://myclabs.github.io/ACL/doc/actions.html">
                                Actions
                            </a>
                        </li>
                        <li class="">
                            <a href="http://myclabs.github.io/ACL/doc/cascading.html">
                                Authorization cascading
                            </a>
                        </li>
                        <li class="">
                            <a href="http://myclabs.github.io/ACL/doc/performances.html">
                                Performances
                            </a>
                        </li>
                    </ul>

                </nav>

                <section class="col-sm-offset-3 col-lg-offset-2 col-sm-9 col-lg-10">
                    <h1>Usage</h1>
<h2>1. Mark your entity as a resource</h2>
<p>Let's say you want to control the access to an entity named <code>Article</code>.</p>
<p>You need to have your entity implement the <code>EntityResource</code> interface:</p>
<pre><code class="language-php">class Article implements EntityResource
{
    // ...

    public function getId()
    {
        return $this-&gt;id;
    }
}</code></pre>
<p>You can also add an association to the roles that apply on this resource.
Such association is very useful so that the roles (and their authorizations) are deleted in cascade
when the resource is deleted:</p>
<pre><code class="language-php">class Article implements EntityResource
{
    // ...

    /**
     * @ORM\OneToMany(targetEntity="ArticleEditorRole", mappedBy="article", cascade={"remove"})
     */
    protected $roles;

    public function __construct()
    {
        $this-&gt;roles = new ArrayCollection();
    }
}</code></pre>
<p>This association can also be useful if you need to find all the "editors" of an article for example.</p>
<h2>2. Creating a new role</h2>
<p>The role gives the authorizations.</p>
<p>To create a new role, extend the <code>Role</code> abstract class:</p>
<pre><code class="language-php">/**
 * @Entity(readOnly=true)
 */
class ArticleEditorRole extends Role
{
    /**
     * @ManyToOne(targetEntity="Article", inversedBy="roles")
     */
    protected $article;

    public function __construct(User $user, Article $article)
    {
        $this-&gt;article = $article;

        parent::__construct($user);
    }

    public function createAuthorizations(ACL $acl)
    {
        $acl-&gt;allow(
            $this,
            new Actions([Actions::VIEW, Actions::EDIT]),
            $this-&gt;article
        );
    }
}</code></pre>
<p>The authorizations given by the role are created in the <code>createAuthorizations()</code> method.</p>
<p>For creating an authorization, you need to call <code>$acl-&gt;allow()</code> with:</p>
<ul>
<li>the role (which will also provide the user/security identity that is being given access)</li>
<li>the actions that are included in the authorization</li>
<li>the resource</li>
</ul>
<p>The resource can be either an entity instance (as shown above) or an entity classname, which will
give access to all entities of that type:</p>
<pre><code class="language-php">// This will allow the users having the role to be able to view ALL the articles
$acl-&gt;allow(
    $this,
    new Actions([Actions::VIEW]),
    new ClassResource('My\Model\Article')
);</code></pre>
                </section>

            </div>
        </div>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                $("section>p:first-child").addClass('lead');
                hljs.initHighlightingOnLoad();
            });
        </script>
    </body>
</html>
